
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../implementation/">
      
      
        <link rel="next" href="../future-work/">
      
      
      <link rel="icon" href="../assets/pokeball.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Challenges - Pokémini Go</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#challenges" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Pokémini Go" class="md-header__button md-logo" aria-label="Pokémini Go" data-md-component="logo">
      
  <img src="../assets/pokeball.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pokémini Go
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Challenges
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Pokémini Go" class="md-nav__button md-logo" aria-label="Pokémini Go" data-md-component="logo">
      
  <img src="../assets/pokeball.png" alt="logo">

    </a>
    Pokémini Go
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../description/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Description
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Design
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../implementation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Implementation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Challenges
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Challenges
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#unable-to-connect-to-common-https-endpoints" class="md-nav__link">
    <span class="md-ellipsis">
      Unable to connect to common HTTPS endpoints
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#unable-to-receive-a-full-nmea-sentence" class="md-nav__link">
    <span class="md-ellipsis">
      Unable to receive a full NMEA sentence
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../future-work/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Future Work
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../bill-of-materials/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bill of Materials
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../map/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Map
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="challenges">Challenges<a class="headerlink" href="#challenges" title="Permanent link">&para;</a></h1>
<p>We encountered a couple of major challenges during the implementation of our
project.</p>
<h2 id="unable-to-connect-to-common-https-endpoints">Unable to connect to common HTTPS endpoints<a class="headerlink" href="#unable-to-connect-to-common-https-endpoints" title="Permanent link">&para;</a></h2>
<p>Our initial idea was to have the Launchpad make HTTPS requests to an AWS Lambda
endpoint. AWS Lambda is a "serverless" compute service. That is, it runs a
defined function when an HTTP endpoint is called, and thus allows us to write
API handlers without having to manually configure and maintain any extra server
infrastructure. However, we encountered major difficulties when attempting to
establish a TLS connection to the Lambda endpoint. At first, we attempted
establishing a TLS connection to the lambda endpoint using the same TLS root,
client, and private certificates that we had configured from Lab 4. However, we
received error code <code>-6</code> from the function <code>sl_Connect()</code>, indicating that a
connection could not be established on the configured TLS socket. We then
attempted manually downloading and flashing the AWS CA Root Certificate onto the
Launchpad. We verified that the certificate was in DER format and also attempted
consolidating it with intermediary certificates used on our particular Lambda
endpoint into other DER files. However, none of these certificate chains
permitted a successful TLS connection. After reading through AWS Lambda TLS
documentation on supported TLS ciphers, we hypothesized that perhaps the default
directly-exposed Lambda certificate required the use of recent ciphers that the
Launchpad did not support. Thus, we also tried configuring an API Gateway, which
is an AWS service for a REST API front-end that allows for more fine-grained
configuration of API endpoints. In particular, API Gateway supports lower
security levels and older ciphers to be explicitly configured on select endpoint
paths to support older clients. However, we could not establish a TLS connection
to the API Gateway either.</p>
<p>We also considered using MQTT and just using the IoT shadow endpoint as
previously used in Lab 4. For MQTT, we read through the sample client code
provided in the TI SDK. However, we realized that the MQTT code required the use
of lightweight operating systems, namely Ti-OS or FreeRTOS, which use hardware
interrupts to implement pre-emptive scheduling for multitasking. If we were to
adapt either of the recommended MQTT clients, then we would have to rewrite all
of our logic to use those operating systems, and given that we had around 4 days
at that point to get a fully working project while balancing other classes, we
decided we did not have enough time to experiment with MQTT.</p>
<p>The other option was using IoT shadow. However, we determined that IoT shadow
would add another layer of indirection and thus complexity, since we would still
need some kind of business logic layer such as a Lambda function to compute
operations on the database, and as well as maintaining the separate <code>reported</code>
and <code>desired</code> IoT Shadow states.</p>
<p>Thus, we decided instead to simply implement an unsecured HTTP endpoint on an
AWS EC2 VPS instance that we already rent yearly. This is where we decided to
use Express.JS to implement this HTTP API endpoint, and so then we have this
service scheduled to automatically run using Node.JS on the VPS.</p>
<p>This was a simple solution permitted under the project constraints that allowed
us to hit all of our minimal, target, and numerous of our stretch goals on-time.</p>
<h2 id="unable-to-receive-a-full-nmea-sentence">Unable to receive a full NMEA sentence<a class="headerlink" href="#unable-to-receive-a-full-nmea-sentence" title="Permanent link">&para;</a></h2>
<p>Initially when we attempted reading the GPS module NMEA sentences over UART and
printing these sentences out into the computer UART console, we discovered that
we were never reading a full NMEA sentence. Specifically, our GNGGA sentence
would always cap at 16 bytes/ASCII characters.</p>
<p>We remembered from Lab 3 that this maximum value was suspiciously similar to the
buffer size of the UART FIFO buffer. Thus, we immediately suspected a similar
issue as to what we had in Lab 3, where our RX buffer interrupt handler was not
reading received bytes fast enough to clear the buffer and allow for the rest of
the message to be received.</p>
<p>Firstly, we tried setting the baudrate to the minimum allowed setting. However,
for our particular board and chip, the HGLRC M100-5883 with a UBlox M10 baseband
chip, the minimum UART speed that we were able to observe a valid response was
19200 baud. Even at this baudrate, we still were only able to read the first 16
characters of any NMEA message.</p>
<p>Then, we decided another technique to also reduce the total number of interrupts
that we would have to trigger. Instead of triggering the UART RX interrupt
handler on every received byte, we instead configured our RX buffer interrupt
handler to run only after every 8th received byte - a half full buffer:</p>
<pre><code>MAP_UARTFIFOLevelSet(UARTA1_BASE, UART_FIFO_TX4_8, UART_FIFO_RX4_8);
</code></pre>
<p>After setting this new interrupt trigger, we were able to observe full NMEA
sentences for all transmitted sentences. We hypothesize that this made such a
big difference because it takes a significant amount of time to altogether raise
the interrupt line, enter the interrupt service routine, run the peripheral code
we implement to read the buffer characters and parse them, and then return
control back to the main process. Thus, we divide the total amount of interrupt
handles by a factor of 8, significantly increasing the rate at which we can
handle incoming UART data.</p>
<p>Lastly, although we at first tested this working solution at 19200 baud, we then
decided to increase the baudrate back up to 57600 baud, which is the highest
baud at which we were able to consistently receive correct NMEA sentences. The
reason for attempting to drive the baudrate back up is because of the high
throughput of data transmitted by the GPS module. Thus, to not hog resources
away from other actions in the game loop, we try to make the transmission and
receipt of GPS data as fast as possible. As is discussed above, we also combine
this with the GPS module timeout where we disable the GPS UART RX interrupt when
not in use.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.sections", "toc.integrate"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>